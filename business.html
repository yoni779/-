<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>×”×× ×›"×œ ×©×œ ×”×§×™×•×¡×§ ğŸ¥¯</title>
    <style>
        :root {
            --bg: #111827;
            --card: #1f2937;
            --text: #f3f4f6;
            --accent: #6366f1;
            --green: #10b981;
            --red: #ef4444;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        header {
            background: #0f172a;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #374151;
            z-index: 10;
        }

        .stats-box { text-align: center; }
        .label { font-size: 0.75rem; color: #9ca3af; }
        .value { font-size: 1.1rem; font-weight: bold; }
        .money { color: var(--green); }
        .level { color: var(--accent); }

        #game-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
            width: 100%;
            box-sizing: border-box;
        }

        .question-card {
            background: var(--card);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            border: 1px solid #374151;
            animation: floatIn 0.4s ease-out;
        }

        @keyframes floatIn {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .category-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        h2 { margin: 0 0 15px 0; font-size: 1.4rem; line-height: 1.3; }
        p  { color: #d1d5db; line-height: 1.6; margin-bottom: 25px; font-size: 1rem; }

        .options-grid { display: flex; flex-direction: column; gap: 12px; }

        .option-btn {
            background: #374151;
            border: 2px solid transparent;
            color: white;
            padding: 16px;
            border-radius: 12px;
            font-size: 1rem;
            cursor: pointer;
            text-align: right;
            transition: all 0.2s;
        }

        .option-btn:active { transform: scale(0.98); }
        .option-btn.correct { background: rgba(16,185,129,0.2); border-color: var(--green); color: var(--green); }
        .option-btn.wrong   { background: rgba(239,68,68,0.2);  border-color: var(--red);   color: var(--red); }
        .option-btn.disabled { opacity: 0.5; pointer-events: none; }

        #feedback-overlay {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            background: rgba(0,0,0,0.9);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            pointer-events: none;
            opacity: 0;
            transition: all 0.3s;
            z-index: 100;
            border: 2px solid #555;
            min-width: 200px;
        }

        #feedback-overlay.show { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        .feedback-icon { font-size: 3rem; display: block; margin-bottom: 10px; }
        .feedback-text { font-size: 1.5rem; font-weight: bold; }
        .feedback-sub  { font-size: 1rem; color: #aaa; margin-top: 5px; }

        #xp-bar-container { height: 6px; background: #374151; width: 100%; position: fixed; bottom: 0; }
        #xp-bar-fill      { height: 100%; background: var(--accent); width: 0%; transition: width 0.5s; }

        #rescue-btn {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(255,255,255,0.06);
            color: #aaa;
            border: 1px solid #555;
            padding: 5px 10px;
            font-size: 0.7rem;
            cursor: pointer;
            z-index: 9999;
            border-radius: 6px;
        }
    </style>
</head>
<body>

<header>
    <div class="stats-box">
        <div class="label">×“×¨×’×”</div>
        <div class="value level" id="ui-level">1</div>
    </div>
    <div class="stats-box">
        <div class="label">××–×•××Ÿ</div>
        <div class="value money" id="ui-money">$5,000</div>
    </div>
    <div class="stats-box">
        <div class="label">XP</div>
        <div class="value" id="ui-xp">0</div>
    </div>
</header>

<div id="game-container"></div>

<div id="feedback-overlay">
    <div class="feedback-icon" id="fb-icon"></div>
    <div class="feedback-text" id="fb-text"></div>
    <div class="feedback-sub"  id="fb-sub"></div>
</div>

<div id="xp-bar-container"><div id="xp-bar-fill"></div></div>

<button id="rescue-btn" onclick="hardReset()">×ª×§×•×¢? ××™×¤×•×¡</button>

<script>
    // ---------- ×§×•× ×¤×™×’×•×¨×¦×™×” ×‘×¡×™×¡×™×ª ----------
    const SAVE_KEY = "ceo_kiosk_save_v1";

    const CATEGORIES = {
        finance:  { name: "×¤×™× × ×¡×™×",      color: "#10b981" },
        marketing:{ name: "×©×™×•×•×§",        color: "#f472b6" },
        hr:       { name: "×¢×•×‘×“×™×",       color: "#a78bfa" },
        ops:      { name: "×ª×¤×¢×•×œ",        color: "#fbbf24" },
        crisis:   { name: "××©×‘×¨×™×",       color: "#ef4444" }
    };

    // ×©××œ×•×ª ×˜×•×˜×•×¨×™××œ â€“ ××•×¤×™×¢×•×ª ×¤×¢× ××—×ª ×‘×”×ª×—×œ×”
    const BASE_QUESTIONS = [
        {
            id: "base1",
            cat: "finance",
            t: "×ª×–×¨×™× ××–×•×× ×™×",
            q: "×”×§×•×¤×” ××œ××” ×‘×¦'×§×™× ×“×—×•×™×™×, ××‘×œ ××™×Ÿ ×›×¡×£ ××–×•××Ÿ ×œ×¡×¤×§×™× ×œ××—×¨. ××” ×”×‘×¢×™×”?",
            opts: [
                "×‘×¢×™×™×ª ×ª×–×¨×™× â€“ ×”×›×¡×£ ×œ× × ×›× ×¡ ×‘×–××Ÿ",
                "×”××—×™×¨×™× ×©×œ×š ×™×§×¨×™× ××“×™",
                "×”×¢×•×‘×“×™× ××¨×•×•×™×—×™× ×™×•×ª×¨ ××“×™"
            ],
            a: 0
        },
        {
            id: "base2",
            cat: "marketing",
            t: "××™×§×•×“ ×§×”×œ",
            q: "×§×™×•×¡×§ ×—×œ×‘×™ ××•×œ ×‘×™×ª ×¡×¤×¨ ×ª×™×›×•×Ÿ. ××” ×›×“××™ ×œ×§×“×?",
            opts: [
                "×§×¤×” ×‘-25 ×©\"×—",
                "×˜×•×¡×˜/××œ×•×•××— ×‘××‘×¦×¢ ×œ×ª×œ××™×“×™×",
                "×™×™× ×•×ª ×‘×•×˜×™×§"
            ],
            a: 1
        },
        {
            id: "base3",
            cat: "hr",
            t: "×¢×•×‘×“ ×—×“×© ×¢×•×©×” ×˜×¢×•×™×•×ª",
            q: "×¢×•×‘×“ ×—×“×© ××ª×‘×œ×‘×œ ×‘×§×•×¤×” ×•×¢×•×©×” ×˜×¢×•×™×•×ª. ××” ×”×¦×¢×“ ×”×›×™ ×—×›×?",
            opts: [
                "×œ×”×•×¨×™×“ ×œ×• ××”××©×›×•×¨×ª ×›×œ ×˜×¢×•×ª",
                "×œ×¤×˜×¨ ××•×ª×• ×‘××§×•×",
                "×œ×ª×ª ×—×¤×™×¤×” ××¡×•×“×¨×ª ×•×œ×”×¡×‘×™×¨ ×©×•×‘"
            ],
            a: 2
        }
    ];

    // ××™×¨×•×¢×™× ×¨×™××œ×™×¡×˜×™×™× â€“ ×™×—×–×¨×• ×¨×§ ××—×¨×™ ×©×¢×•×‘×¨×™× ×¢×œ ×›×•×œ×
    const EVENTS = [
        {
            id: "ev1",
            cat: "ops",
            t: "××§×¨×¨ ×”×ª×§×œ×§×œ",
            q: "×”××§×¨×¨ ×©×œ ×”×’×‘×™× ×•×ª ×”×¤×¡×™×§ ×œ×¢×‘×•×“ ×‘×œ×™×œ×”. ×”×›×•×œ ×¤×•×©×¨.",
            opts: [
                "×œ××›×•×¨ ×›×¨×’×™×œ â€“ ×—×‘×œ ×¢×œ ×”×›×¡×£",
                "×œ×–×¨×•×§ ××ª ×”××¡×•×›×Ÿ, ×œ×§×¨×•× ×œ×˜×›× ××™, ×•×œ×¤×¢×•×œ ×œ×¤×™ ×”×ª×§×Ÿ",
                "×œ×”×—×–×™×¨ ×œ××§×¨×¨ ×•×œ×—×›×•×ª ×©×™×ª×§×¨×¨ ×©×•×‘"
            ],
            a: 1,
            costBase: 800,
            rewardBase: 1500
        },
        {
            id: "ev2",
            cat: "hr",
            t: "×¢×•×‘×“ ×—×•×œ×”",
            q: "×¢×•×‘×“ ×”×¢×¨×‘ ××•×“×™×¢ ×©×”×•× ×—×•×œ×” ×•××™×Ÿ ××—×œ×™×£.",
            opts: [
                "×œ×¡×’×•×¨ ××•×§×“× ×•×œ×”×¤×¡×™×“ ×”×›× ×¡×•×ª",
                "×œ×”×’×™×¢ ×‘×¢×¦××š ×•×œ×¢×‘×•×“ ×‘××§×•××•",
                "×œ×”×›×¨×™×— ××•×ª×• ×œ×‘×•× ×—×•×œ×”"
            ],
            a: 1,
            costBase: 0,
            rewardBase: 600
        },
        {
            id: "ev3",
            cat: "marketing",
            t: "×ª×—×¨×•×ª ×œ×™×“×š",
            q: "× ×¤×ª×— ×§×™×•×¡×§ ×—×“×© ×œ×™×“×š ×¢× ××—×™×¨×™× ×–×•×œ×™× ×™×•×ª×¨.",
            opts: [
                "×œ×”×•×¨×™×“ ××—×™×¨×™× ×•×œ×©×‘×•×¨ ××ª ×”×©×•×§",
                "×œ×”×ª××§×“ ×‘××™×›×•×ª, ×©×™×¨×•×ª ×•×”×‘×“×œ ×‘××•×¦×¨",
                "×œ×¦×¢×•×§ ×¢×œ×™×• ×©×™×¡×’×•×¨"
            ],
            a: 1,
            costBase: 200,
            rewardBase: 1000
        },
        {
            id: "ev4",
            cat: "finance",
            t: "×¡×¤×§ ×™×§×¨",
            q: "×¡×¤×§ ×”×™×¨×§×•×ª ×”×¢×œ×” ××—×™×¨×™× ×‘-20%.",
            opts: [
                "×œ×¡×¤×•×’ ××ª ×–×” ×‘×©×§×˜",
                "×œ×”×©×•×•×ª ××—×™×¨×™×, ×œ× ×”×œ ××•\"× ×•×œ××¦×•× ×¤×ª×¨×•×Ÿ ××©×ª×œ×",
                "×œ×”×¢×œ×•×ª ××—×™×¨×™× ×œ×œ×§×•×—×•×ª ×‘×œ×™ ×œ×—×©×‘"
            ],
            a: 1,
            costBase: 100,
            rewardBase: 800
        },
        {
            id: "ev5",
            cat: "crisis",
            t: "×œ×§×•×— ×›×•×¢×¡",
            q: "×œ×§×•×— ×˜×•×¢×Ÿ ×©××¦× ×©×¢×¨×” ×‘×˜×•×¡×˜ ×•×“×•×¨×© ×¤×™×¦×•×™.",
            opts: [
                "×œ×’×¨×© ××•×ª×• ××”×—× ×•×ª",
                "×œ×”××©×™× ××ª ×”×œ×§×•×— ×©×”×•× ×××¦×™×",
                "×œ×”×ª× ×¦×œ, ×œ×”×—×œ×™×£ ×× ×” ×•×œ×ª×ª ×¤×™×¦×•×™ ×§×˜×Ÿ"
            ],
            a: 2,
            costBase: 50,
            rewardBase: 500
        }
    ];

    // ×¨×©×™××ª ××™×¨×•×¢×™× ×©×›×‘×¨ ×©×•×—×§×• (×›×“×™ ×œ× ×œ×—×–×•×¨ ×¢×œ ×¢×¦××)
    let usedEventIds = [];

    // ××¦×‘ ×”×©×—×§×Ÿ
    let player = {
        money: 5000,
        xp: 0,
        level: 1,
        qIndex: 0
    };

    // ××ª×—×•×œ ××”×©××™×¨×”
    (function init() {
        try {
            const saved = localStorage.getItem(SAVE_KEY);
            if (saved) {
                const parsed = JSON.parse(saved);
                if (parsed && typeof parsed === "object") {
                    player = parsed;
                }
            }
        } catch(e) {
            console.log("×©××™×¨×” ×¤×’×•××”, ××ª×—×™×œ×™× ××—×“×©", e);
        }
        renderUI();
        nextTurn();
    })();

    // ---------- ×œ×•×’×™×§×ª ×”××©×—×§ ----------

    function nextTurn() {
        const container = document.getElementById("game-container");
        container.innerHTML = "";

        let scenario;

        // ×©×œ×‘ 1 â€“ ×©××œ×•×ª ×‘×¡×™×¡ (××•×¤×™×¢×•×ª ×¤×¢× ××—×ª)
        if (player.qIndex < BASE_QUESTIONS.length) {
            const q = BASE_QUESTIONS[player.qIndex];
            scenario = {
                cat: q.cat,
                t: q.t,
                q: q.q,
                opts: q.opts,
                a: q.a,
                cost: 0,
                reward: 300
            };
        }
        // ×©×œ×‘ 2 â€“ ××™×¨×•×¢×™× ××™× ×¡×•×¤×™×™× ×‘×œ×™ ×—×–×¨×”
        else {
            const ev = getNextEvent();
            const multiplier = 1 + player.level * 0.2;

            scenario = {
                cat: ev.cat,
                t: ev.t,
                q: ev.q,
                opts: ev.opts,
                a: ev.a,
                cost: Math.floor(ev.costBase * multiplier),
                reward: Math.floor(ev.rewardBase * multiplier)
            };
        }

        renderCard(scenario);
    }

    // ×“×•××’ ×©×œ× ×™×—×–×•×¨ ××™×¨×•×¢ ×¢×“ ×©×¢×‘×¨× ×• ×¢×œ ×›×•×œ×
    function getNextEvent() {
        // ×× ×›×‘×¨ ×¢×‘×¨× ×• ×¢×œ ×›×œ ×”××™×¨×•×¢×™× â€“ ×××¤×¡×™× ×¨×©×™××” ×•××¢×œ×™× ×¨××”
        if (usedEventIds.length >= EVENTS.length) {
            usedEventIds = [];
            player.level++;
            player.xp = 0;
        }

        const available = EVENTS.filter(ev => !usedEventIds.includes(ev.id));
        const ev = available[Math.floor(Math.random() * available.length)];
        usedEventIds.push(ev.id);
        return ev;
    }

    function renderCard(scenario) {
        const container = document.getElementById("game-container");
        const catData = CATEGORIES[scenario.cat] || { name: "×¢×¡×§", color: "#ffffff" };
        const color = catData.color;

        const card = document.createElement("div");
        card.className = "question-card";

        card.innerHTML = `
            <div class="category-badge" style="background:${color}20; color:${color}">${catData.name}</div>
            <h2>${scenario.t}</h2>
            <p>${scenario.q}</p>
            <div class="options-grid"></div>
        `;

        const grid = card.querySelector(".options-grid");
        scenario.opts.forEach((text, i) => {
            const btn = document.createElement("div");
            btn.className = "option-btn";
            btn.innerText = text;
            btn.onclick = () => handleAnswer(btn, i, scenario.a, scenario.reward, scenario.cost);
            grid.appendChild(btn);
        });

        container.appendChild(card);
    }

    function handleAnswer(btn, selected, correct, reward, cost) {
        const btns = document.querySelectorAll(".option-btn");
        btns.forEach(b => b.classList.add("disabled"));

        const isWin = (selected === correct);

        if (isWin) {
            btn.classList.add("correct");
            processResult(true, reward);
        } else {
            btn.classList.add("wrong");
            if (btns[correct]) {
                btns[correct].classList.add("correct");
            }
            const penalty = cost > 0 ? cost : 200;
            processResult(false, -penalty);
        }

        player.qIndex++;
        savePlayer();

        setTimeout(() => {
            hideFeedback();
            nextTurn();
        }, 1500);
    }

    function processResult(win, amount) {
        player.money += amount;

        if (win) {
            player.xp += 100 * player.level;
        } else {
            player.xp += 20;
        }

        checkLevel();
        renderUI();
        showFeedback(win, amount);
    }

    // ---------- UI / ×¤×™×“×‘×§ ----------

    function showFeedback(win, amount) {
        const overlay = document.getElementById("feedback-overlay");
        const icon = document.getElementById("fb-icon");
        const text = document.getElementById("fb-text");
        const sub  = document.getElementById("fb-sub");

        overlay.classList.add("show");

        if (win) {
            icon.innerText = "ğŸ¤‘";
            text.innerText = "××¢×•×œ×”!";
            text.style.color = "var(--green)";
            sub.innerText  = "+$" + amount.toLocaleString();
        } else {
            icon.innerText = "ğŸ“‰";
            text.innerText = "××•×¤×¡...";
            text.style.color = "var(--red)";
            sub.innerText  = "-$" + Math.abs(amount).toLocaleString();
        }
    }

    function hideFeedback() {
        document.getElementById("feedback-overlay").classList.remove("show");
    }

    function renderUI() {
        document.getElementById("ui-level").innerText = player.level;
        document.getElementById("ui-money").innerText = "$" + player.money.toLocaleString();
        document.getElementById("ui-xp").innerText = player.xp;

        const need = player.level * 1000;
        const pct = Math.max(0, Math.min(100, (player.xp / need) * 100));
        document.getElementById("xp-bar-fill").style.width = pct + "%";
    }

    function checkLevel() {
        const need = player.level * 1000;
        if (player.xp >= need) {
            player.level++;
            player.xp = 0;
        }
    }

    function savePlayer() {
        try {
            localStorage.setItem(SAVE_KEY, JSON.stringify(player));
        } catch(e) {
            console.log("×©××™×¨×” × ×›×©×œ×”", e);
        }
    }

    function hardReset() {
        if (confirm("×œ××¤×¡ ××ª ×”××©×—×§ ××”×ª×—×œ×”?")) {
            localStorage.removeItem(SAVE_KEY);
            location.reload();
        }
    }
</script>

</body>
</html>
